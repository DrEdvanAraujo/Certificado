<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Certificado CIPICS</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #f7f7f7;
      display: flex;
      flex-direction: column; /* Use column layout */
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }

    .certificado {
      width: 800px; /* Adjust width for screen view */
      padding: 40px;
      border: 10px solid #4a8062;
      background-image: repeating-linear-gradient(
        45deg,
        #f0f9f4,
        #f0f9f4 10px,
        #ffffff 10px,
        #ffffff 20px
      );
      position: relative; /* Needed for absolute positioning of logos, watermarks, and signature */
      text-align: center;
      box-sizing: border-box; /* Include padding and border in the element's total width and height */
      margin: 20px; /* Add some margin for screen view */
      overflow: hidden; /* Important: Hide parts of watermark if it overflows */
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Add subtle shadow */
    }

    .certificado-logo {
      position: absolute;
      top: 20px; /* Adjust position from the top */
      left: 20px; /* Adjust position from the left */
      width: 80px; /* Set the width of the logo */
      height: auto; /* Maintain aspect ratio */
      z-index: 10; /* Ensure the small logo is above other elements */
    }

    .certificado-watermark {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('https://i.ibb.co/T9VGRv6/Chat-GPT-Image-23-04-2025-22-09-23-removebg-preview.png');
      background-size: contain; /* Use 'contain' to fit the whole logo, 'cover' to fill while potentially cropping */
      background-repeat: no-repeat;
      background-position: center; /* Center the watermark */
      opacity: 0.1; /* Adjust transparency (0 = fully transparent, 1 = fully opaque) */
      z-index: 1; /* Ensure watermark is behind text and small logo */
      pointer-events: none; /* Allows clicking/selecting text through the watermark */
    }

    /* Style for the secondary electronic signature image in the bottom right */
    .certificado-assinatura-eletronica-rodape {
        position: absolute;
        bottom: 20px; /* Distance from the bottom edge of the certificate */
        right: 40px; /* Distance from the right edge of the certificate */
        width: 150px; /* Adjust size as needed */
        height: auto; /* Maintain aspect ratio */
        z-index: 10; /* Ensure it's above the watermark */
    }

    /* Style for the main signature image above the name */
     .assinatura-principal {
        display: block; /* Ensure it takes up space and can be centered */
        margin: 0 auto 5px auto; /* Center horizontally and add a little space below */
        width: 200px; /* Adjust size as needed */
        height: auto; /* Maintain aspect ratio */
        z-index: 10; /* Ensure it's above the watermark */
     }


    .certificado h1 {
      font-size: 30px;
      color: #333;
      margin-bottom: 10px;
    }

    .certificado h2 {
      font-size: 20px;
      color: #4a8062;
      margin-bottom: 30px;
    }

    .certificado p {
        font-size: 16px; /* Default paragraph font size */
    }


    .nome, .data {
      font-size: 22px;
      font-weight: bold;
      color: #000;
      border-bottom: 1px solid #aaa;
      display: inline-block;
      padding: 5px 20px;
      margin: 10px auto; /* Center inline-block with margin auto and display */
      min-width: 300px;
      text-align: center; /* Center text inside the editable div */
      white-space: nowrap; /* Prevent wrapping in editable field if possible */
      overflow: hidden; /* Hide overflow if nowrap causes issues */
      text-overflow: ellipsis; /* Add ellipsis if text is too long */
    }

    .assinatura {
      margin-top: 20px; /* Adjusted margin */
      /* Keep text-align: center from .certificado */
      position: relative;
    }

    .assinatura span {
      display: block; /* Make the name span a block element */
      font-weight: bold;
      color: #4a8062;
      font-size: 16px; /* Default signature font size */
      margin-top: 0; /* Remove top margin if signature image adds spacing */
    }

    button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 16px;
      cursor: pointer;
      border: none;
      border-radius: 5px;
      color: white;
      transition: background-color 0.3s ease;
    }

    button:disabled {
        background-color: #cccccc !important;
        cursor: not-allowed;
        opacity: 0.6;
    }

    #imprimir {
      background-color: #4a8062;
    }
     #imprimir:hover:not(:disabled) {
        background-color: #3a6a4e; /* Darken color on hover */
     }

    #editar {
      background-color: #3b6bbd;
    }
    #editar:hover:not(:disabled) {
        background-color: #2f5a9c; /* Darken color on hover */
    }


    /* CSS rules for printing */
    @media print {
      button {
        display: none; /* Hide all buttons when printing */
      }

      html, body {
          height: 100%; /* Make html and body fill the full height */
          margin: 0; /* Remove margin */
          padding: 0; /* Remove padding */
          background-color: #fff; /* White background for printing */
          overflow: hidden; /* Prevent scrolling in print */
      }

      body {
        display: block; /* Use block layout for printing */
        min-height: auto; /* Reset min-height */
      }


      /* Specific page rule to control print page size and margins */
      @page {
          size: landscape; /* Set the page orientation */
          margin: 0; /* Set page margin to zero to maximize printable area */
      }

      .certificado {
        width: 100%; /* Make certificate fill the width available within page margins (now 100% of page) */
        height: 100%; /* Make certificate fill the height available within page margins */
        margin: 0; /* Remove margin for printing */
        padding: 40px; /* Keep padding to space content from border */
        border: 10px solid #4a8062; /* Keep the border */
        box-sizing: border-box; /* Ensure padding and border are included in width/height */
        box-shadow: none; /* Remove shadow if any */
        /* Use flexbox to help center content vertically within the full height */
        display: flex;
        flex-direction: column;
        justify-content: center; /* Center content vertically */
        align-items: center; /* Center content horizontally */
        text-align: center;
      }

      /* The watermark styles are outside @media print, so they apply to print as well */
      /* .certificado-watermark properties will carry over */

      .certificado-logo {
         position: absolute;
         top: 20px;
         left: 20px;
         width: 80px;
         height: auto;
         z-index: 10;
      }

       /* Ensure secondary electronic signature is positioned correctly in print */
       .certificado-assinatura-eletronica-rodape {
            position: absolute; /* Keeps absolute positioning */
            bottom: 20px; /* Same bottom position */
            right: 40px; /* Same right position */
            width: 150px; /* Same size */
            height: auto;
            z-index: 10;
        }

        /* Ensure main signature image is positioned correctly in print */
        .assinatura-principal {
            display: block; /* Keeps block display */
            margin: 0 auto 5px auto; /* Keeps margin for centering and spacing */
            width: 200px; /* Same size */
            height: auto;
            z-index: 10;
        }


      /* Increase font sizes further for better readability in print */
      .certificado h1 {
        font-size: 40px; /* Increased */
      }

      .certificado h2 {
        font-size: 28px; /* Increased */
      }

      .certificado p {
        font-size: 20px; /* Increased */
      }

      .nome, .data {
        font-size: 30px; /* Increased */
        min-width: 400px; /* Maybe increase min-width too */
        border-bottom: none; /* Remove border for print */
        font-weight: normal; /* Set font weight to normal for print */
        margin: 10px 0; /* Adjust margin for print */
        padding: 5px 0; /* Adjust padding for print */
      }

      .assinatura {
          margin-top: 30px; /* Increased margin for print */
      }

      .assinatura span {
        font-size: 20px; /* Increased */
      }
    }
  </style>
</head>
<body>

<div class="certificado" id="certificado">
  <!-- Watermark added here - positioned before content -->
  <div class="certificado-watermark"></div>

  <!-- Small Logo kept here -->
  <img src="https://i.ibb.co/T9VGRv6/Chat-GPT-Image-23-04-2025-22-09-23-removebg-preview.png" alt="Logo" class="certificado-logo">

  <h1>CERTIFICADO</h1>
  <h2>CIPICS - Curso de Introdução às Práticas Integrativas e Complementares em Saúde e ao Autocuidado</h2>

  <p>Certificamos que</p>

  <div contenteditable="true" class="nome">[Nome do Participante] - CPF [CPF]</div>
  <p>concluiu com êxito o curso com carga horária total de <strong>60 horas</strong>, promovido sob responsabilidade de Edvan Araujo (CRM-BA 34216).</p>

  <!-- The data div where the date will be automatically set -->
  <div contenteditable="true" class="data">[Data de Conclusão]</div>

  <div class="assinatura">
    <!-- Main Electronic Signature Image added here -->
    <img src="https://i.ibb.co/yFBmdxn3/assinatura-digital-removebg-preview.png" alt="Assinatura Principal" class="assinatura-principal">
    <span>Dr. Edvan Araujo</span>
    CRM-BA 34216
  </div>

  <!-- Secondary Electronic Signature Image added here (bottom right) -->
  <img src="https://i.ibb.co/GvTCc9Lj/ASS.jpg" alt="Assinatura Eletrônica Rodapé" class="certificado-assinatura-eletronica-rodape">

</div>

<!-- Buttons are kept outside the certificate div for easier printing -->
<button id="imprimir" onclick="window.print()">Imprimir Certificado</button>
<button id="editar" onclick="editarNomeData()">Editar Informações</button>
<!-- Message area for completion status (optional, not requested but could be useful) -->
<!-- <p id="completionMessage" style="color: red; font-weight: bold;"></p> -->


<script>
    // Define the structure of tasks per week - used to calculate total tasks
    const tarefasPorSemana = {
      "Semana 1: Contextualização das PICS, política, racionalidades médicas e Autocuidado": ["tarefa1a", "tarefa1b", "tarefa1c", "tarefa1d", "tarefa1e", "tarefa1f"],
      "Semana 2: Aromaterapia, Fitoterapia e Terapia de Florais": ["tarefa2a", "tarefa2b", "tarefa2c", "tarefa2d", "tarefa2e", "tarefa2f"],
      "Semana 3: Naturopatia, Ayurveda e Yoga": ["tarefa3a", "tarefa3b", "tarefa3c", "tarefa3d", "tarefa3e", "tarefa3f"],
      "Semana 4: Meditação, Musicoterapia e Arteterapia": ["tarefa4a", "tarefa4b", "tarefa4c", "tarefa4d", "tarefa4e", "tarefa4f"],
      "Semana 5: Bioenergética, Biodança e Dança Circular": ["tarefa5a", "tarefa5b", "tarefa5c", "tarefa5d", "tarefa5e", "tarefa5f"],
      "Semana 6: Constelação Familiar, Cromoterapia e Terapia Comunitária": ["tarefa6a", "tarefa6b", "tarefa6c", "tarefa6d", "tarefa6e", "tarefa6f"],
      "Semana 7: Hipnoterapia, Imposição de Mãos e Geoterapia": ["tarefa7a", "tarefa7b", "tarefa7c", "tarefa7d", "tarefa7e", "tarefa7f"],
      "Semana 8: Reiki, Reflexoterapia e Shantala": ["tarefa8a", "tarefa8b", "tarefa8c", "tarefa8d", "tarefa8e", "tarefa8f"],
      "Semana 9: Homeopatia, Termalismo e MTC/Acupuntura": ["tarefa9a", "tarefa9b", "tarefa9c", "tarefa9d", "tarefa9e", "tarefa9f"],
      "Semana 10: Antroposofia, Apiterapia, Ozonioterapia, Osteopatia e Quiropraxia": ["tarefa10a", "tarefa10b", "tarefa10c", "tarefa10d", "tarefa10e", "tarefa10f"]
    };

    // Helper function to get user progress from localStorage
    function getProgressoUsuario(email) {
      const todos = JSON.parse(localStorage.getItem("progressoUsuarios") || "{}");
      return todos[email] || {};
    }

    // Helper function to get the current user's email from localStorage session data
    function getUserEmailFromSession() {
        const userJson = localStorage.getItem("currentUserStatus"); // Key used in the previous login code
        try {
            const session = userJson ? JSON.parse(userJson) : null;
            if (session && typeof session === 'object' && session.email) {
                return session.email.toLowerCase(); // Return email if found
            }
            return null; // No session or email found
        } catch (e) {
            console.error("Failed to parse user session from localStorage:", e);
            return null; // Return null if parsing fails
        }
    }

    // Function to check task completion and enable/disable the print button
    function checkCompletionAndEnablePrint() {
        const printButton = document.getElementById('imprimir');
        // const completionMessage = document.getElementById('completionMessage'); // Optional message element

        const currentUserEmail = getUserEmailFromSession();

        if (!currentUserEmail) {
            console.log("Nenhum usuário logado encontrado em localStorage. Impressão desabilitada.");
            printButton.disabled = true;
            printButton.title = 'Nenhum usuário identificado. Acesso ao certificado restrito.';
            // if(completionMessage) completionMessage.textContent = 'Identificação do usuário necessária para liberar o certificado.';
            return; // Stop here if no user is identified
        }

        const progresso = getProgressoUsuario(currentUserEmail);
        let totalTasks = 0;
        let completedTasks = 0;

        for (const semana in tarefasPorSemana) {
            const tarefas = tarefasPorSemana[semana];
            totalTasks += tarefas.length;
            tareas.forEach(tarefa => {
                if (progresso[tarefa] === "concluida") {
                    completedTasks++;
                }
            });
        }

        const isComplete = totalTasks > 0 && completedTasks === totalTasks;

        if (isComplete) {
            printButton.disabled = false;
            printButton.title = ''; // Remove title if enabled
            // if(completionMessage) completionMessage.textContent = ''; // Clear message
            console.log(`Usuário ${currentUserEmail}: Todas as tarefas concluídas (${completedTasks}/${totalTasks}). Impressão habilitada.`);
        } else {
            printButton.disabled = true;
            printButton.title = `Você precisa completar todas as ${totalTasks} tarefas (${completedTasks} concluídas) para imprimir o certificado.`;
            // if(completionMessage) completionMessage.textContent = `Você precisa completar todas as ${totalTasks} tarefas (${completedTasks} concluídas) para imprimir o certificado.`;
            console.log(`Usuário ${currentUserEmail}: Tarefas não concluídas (${completedTasks}/${totalTasks}). Impressão desabilitada.`);
        }
    }


    // Function to format date as dd/mm/yyyy
    function formatDate(date) {
      const day = String(date.getDate()).padStart(2, '0');
      const month = String(date.getMonth() + 1).padStart(2, '0'); // Month is 0-indexed
      const year = date.getFullYear();
      return `${day}/${month}/${year}`;
    }

    // Function to set the current date
    function setCurrentDate() {
      const dateElement = document.querySelector('.data');
      if (dateElement) {
        const today = new Date();
        dateElement.textContent = formatDate(today);
      }
    }

    // Function triggered by the "Editar" button to focus on the name field
    function editarNomeData() {
      const nomeElement = document.querySelector('.nome');
      if (nomeElement) {
        nomeElement.focus();
      }
      // Data field is already contenteditable, focus is often less useful there
    }

    // On page load: set the date and check if printing should be enabled
    window.onload = () => {
        setCurrentDate();
        checkCompletionAndEnablePrint();

        // Optional: Prefill name/cpf if stored somewhere else (not requested, keeping it simple with just editing)
        // const nameField = document.querySelector('.nome');
        // if (nameField.textContent.includes('[Nome do Participante]')) {
        //    // Maybe retrieve user name/CPF from localStorage or another source here
        //    // For now, leave it as a placeholder for user to edit
        // }
    };
</script>

</body>
</html>
